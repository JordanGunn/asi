{
  "metadata": {
    "intent": "Formalize the new asi-enhance workflow with phased planning and structured context for each enhancement task.",
    "goals": [
      "Document the new generator/TRACKER flow so authors know how to run it.",
      "Produce phased plans plus a phase tracker for enhancement tasks.",
      "Ensure the helper exposes the next task context for the developer skill."
    ],
    "non_goals": [
      "Execute commands without a plan approval.",
      "Replace external scripts such as workplan or developer."
    ],
    "scope": [
      "Generate WORKPLAN.md from this definition.",
      "Emit execution/phase_progress.json and execution/next_task_context.json.",
      "Document the helper script that developers call after each completed task."
    ],
    "constraints": [
      "Plans must include the required metadata block (Intent → Approval).",
      "Phase tracker must remain under execution/.",
      "Helper output must remain deterministic and auditable."
    ],
    "approval_pattern": "^Approved:[[:space:]]+yes$",
    "required_sections": "Intent,Goals,Non-Goals,Scope,Constraints,Plan,Commands,Validation,Approval",
    "validation_policy": "explicit commands (guard scripts + scans)",
    "commands": [
      "python3 scripts/generate_plan.py --definition plans/phase_plan.json --output WORKPLAN.md --progress execution/phase_progress.json",
      "./scripts/phase-helper.sh ensure-plan --plan ./WORKPLAN.md --progress execution/phase_progress.json"
    ],
    "validation_steps": [
      "./scripts/validate-plan.sh --plan ./WORKPLAN.md --required \"Intent,Goals,Non-Goals,Scope,Constraints,Plan,Commands,Validation,Approval\" --approval-pattern \"^Approved:[[:space:]]+yes$\"",
      "./scripts/check-workspace.sh --root . --fail-on-dirty"
    ],
    "approval": {
      "Approved": "yes",
      "Approved by": "bsmith",
      "Approved on": "2026-01-28"
    }
  },
  "phases": [
    {
      "name": "Phase 1 — Document the pipeline",
      "summary": "Describe how asi-enhance now uses the generator/helper/progress tracker before enhancing a skill.",
      "tasks": [
        {
          "id": "T001",
          "summary": "Clarify the new README and SKILL guidance to mention the phased plan definition and tracker.",
          "description": "Update README.md, SKILL.md, and references to describe the generator, the helper, and the synchronized context files.",
          "commands": [
            "rg -n \"phase_plan\" README.md SKILL.md references/*.md"
          ],
          "verification": [
            "python3 scripts/generate_plan.py --definition plans/phase_plan.json --output WORKPLAN.md --progress execution/phase_progress.json"
          ]
        }
      ]
    },
    {
      "name": "Phase 2 — Implement the generator/tracker",
      "summary": "Add scripts that render WORKPLAN.md from the definition and update the progress file.",
      "tasks": [
        {
          "id": "T002",
          "summary": "Create scripts/generate_plan.py and scripts/update_phase_progress.py plus the phase definition.",
          "description": "Ensure they stay deterministic, include metadata field references, and output `execution/next_task_context.json` when returning the next task.",
          "commands": [
            "python3 scripts/generate_plan.py --definition plans/phase_plan.json --output WORKPLAN.md --progress execution/phase_progress.json"
          ],
          "verification": [
            "cat execution/phase_progress.json"
          ]
        }
      ]
    },
    {
      "name": "Phase 3 — Helper integration",
      "summary": "Expose scripts/phase-helper.sh so execute-plan runs workplan-like next-task queries.",
      "tasks": [
        {
          "id": "T003",
          "summary": "Add scripts/phase-helper.sh and update documentation so the helper runs before/after tasks.",
          "description": "The helper should regenerate the plan if needed and emit the next task context after updates.",
          "commands": [
            "./scripts/phase-helper.sh ensure-plan --plan ./WORKPLAN.md --progress execution/phase_progress.json"
          ],
          "verification": [
            "./scripts/phase-helper.sh next-task --plan ./WORKPLAN.md --progress execution/phase_progress.json --task T001 --output execution/next_task_context.json"
          ]
        }
      ]
    }
  ]
}
